<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Report - VulnScanner</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='style.css') }}" rel="stylesheet">
  </head>
  <body class="bg-light">
    <div class="container py-4">
      <a href="/" class="btn btn-link">&larr; Home</a>
      <div class="d-flex align-items-center mb-3">
        <img src="{{ url_for('static', filename='images/lock.svg') }}" alt="lock" style="width:48px;margin-right:12px;" />
        <div>
          <h1 class="mb-0">Report for {{ job.target }}</h1>
          <div class="muted-small">Status: <strong>{{ job.status }}</strong></div>
        </div>
      </div>
      {% if results %}
      <h3>Summary</h3>
      <p>Pages scanned: {{ results.summary.pages }}</p>

      <h3 class="mt-4">SQL Injection Findings</h3>
      {% if results.sqli %}
        <div class="row g-3">
        {% for f in results.sqli %}
          <div class="col-md-6" data-aos="fade-up">
            <div class="card border-start border-4 border-danger">
              <div class="card-body">
                <div class="d-flex justify-content-between align-items-start">
                  <div>
                    <strong>{{ f.param }}</strong> on <span class="muted-small">{{ f.url }}</span>
                    <div class="mt-2">Type: <span class="badge bg-danger">{{ f.type }}</span></div>
                  </div>
                </div>
                {% if f.evidence %}
                <pre class="mt-2 small">{{ f.evidence | truncate(200) }}</pre>
                {% endif %}
              </div>
            </div>
          </div>
        {% endfor %}
        </div>
      {% else %}
        <p>No SQLi findings.</p>
      {% endif %}

      <h3 class="mt-4">XSS Findings</h3>
      {% if results.xss %}
        <div class="row g-3">
        {% for f in results.xss %}
          <div class="col-md-6" data-aos="fade-up">
            <div class="card border-start border-4 border-warning">
              <div class="card-body">
                <strong>{{ f.param }}</strong> on <span class="muted-small">{{ f.url }}</span>
                <div class="mt-2">Payload: <code>{{ f.payload }}</code></div>
                {% if f.evidence_snippet %}
                <pre class="mt-2 small">{{ f.evidence_snippet | truncate(200) }}</pre>
                {% endif %}
              </div>
            </div>
          </div>
        {% endfor %}
        </div>
      {% else %}
        <p>No XSS findings.</p>
      {% endif %}

      <h3 class="mt-4">Directory Findings</h3>
      {% if results.dirs %}
        <div class="row g-2">
        {% for d in results.dirs %}
          <div class="col-md-6" data-aos="fade-up">
            <div class="card">
              <div class="card-body">
                <div>{{ d.url }} <span class="badge bg-info ms-2">{{ d.status }}</span></div>
              </div>
            </div>
          </div>
        {% endfor %}
        </div>
      {% else %}
        <p>No interesting directories found.</p>
      {% endif %}

      <h3 class="mt-4">Discovered Forms</h3>
      {% if results.forms %}
        <div class="row g-2">
        {% for form in results.forms %}
          <div class="col-md-12" data-aos="fade-up">
            <div class="card">
              <div class="card-body">
                <div><strong>Action:</strong> {{ form.action or '/' }} &nbsp; <strong>Method:</strong> {{ form.method }}</div>
                <div class="mt-1">Inputs: {{ form.inputs | map(attribute='name') | join(', ') }}</div>
              </div>
            </div>
          </div>
        {% endfor %}
        </div>
      {% else %}
        <p>No forms discovered.</p>
      {% endif %}

      <h3 class="mt-4">Analyzer Findings</h3>
      {% set a = results.analyzer if results.analyzer else {} %}

      {% if a.security_headers %}
        <h5 class="mt-3">Security Headers</h5>
        <div class="row g-2">
          {% for sh in a.security_headers %}
            <div class="col-md-6" data-aos="fade-up">
              <div class="card">
                <div class="card-body">
                  <div><strong>{{ sh.url }}</strong></div>
                  <ul>
                    {% for it in sh.issues %}
                      <li>{{ it }}</li>
                    {% endfor %}
                  </ul>
                </div>
              </div>
            </div>
          {% endfor %}
        </div>
      {% endif %}

      {% if a.cookies %}
        <h5 class="mt-3">Cookie Security</h5>
        <div class="row g-2">
          {% for c in a.cookies %}
            <div class="col-md-6" data-aos="fade-up">
              <div class="card">
                <div class="card-body">
                  <div><strong>{{ c.url }}</strong></div>
                  <ul>
                    {% for ck in c.issues %}
                      <li>Cookie <code>{{ ck.cookie }}</code> missing flags: {{ ck.missing_flags | join(', ') }}</li>
                    {% endfor %}
                  </ul>
                </div>
              </div>
            </div>
          {% endfor %}
        </div>
      {% endif %}

      {% if a.cors %}
        <h5 class="mt-3">CORS</h5>
        <div class="row g-2">
        {% for c in a.cors %}
          <div class="col-md-6" data-aos="fade-up">
            <div class="card">
              <div class="card-body">
                <div><strong>{{ c.url }}</strong></div>
                <div class="mt-1">{{ c.issue or '' }} {% if c.value %}- {{ c.value }}{% endif %}{% if c.acao %}- ACAO: {{ c.acao }}{% endif %}</div>
              </div>
            </div>
          </div>
        {% endfor %}
        </div>
      {% endif %}

      {% if a.rate_limit %}
        <h5 class="mt-3">Rate limiting</h5>
        <div class="row g-2">
        {% for r in a.rate_limit %}
          <div class="col-md-6" data-aos="fade-up">
            <div class="card">
              <div class="card-body">
                <div><strong>{{ r.url }}</strong></div>
                <div>429 seen: {{ r.get('429_seen', False) }}</div>
                {% if r.throttling_suspected %}<div class="text-warning">Throttling suspected</div>{% endif %}
              </div>
            </div>
          </div>
        {% endfor %}
        </div>
      {% endif %}

      {% if a.robots %}
        <h5 class="mt-3">robots.txt</h5>
        <div class="row g-2">
        {% for r in a.robots %}
          <div class="col-md-8" data-aos="fade-up">
            <div class="card">
              <div class="card-body">
                <div><strong>{{ r.url }}</strong></div>
                {% if r.disallows %}
                  <div class="mt-2">Disallow entries:</div>
                  <ul>
                    {% for d in r.disallows %}<li>{{ d }}</li>{% endfor %}
                  </ul>
                {% else %}
                  <div>Status: {{ r.status }}</div>
                {% endif %}
              </div>
            </div>
          </div>
        {% endfor %}
        </div>
      {% endif %}

      {% if a.backups %}
        <h5 class="mt-3">Backup / config exposures</h5>
        <div class="row g-2">
        {% for b in a.backups %}
          <div class="col-md-8" data-aos="fade-up">
            <div class="card">
              <div class="card-body">
                <div><a href="{{ b.url }}" target="_blank">{{ b.url }}</a> <span class="badge bg-danger ms-2">{{ b.status }}</span></div>
              </div>
            </div>
          </div>
        {% endfor %}
        </div>
      {% endif %}

      {% if a.file_uploads %}
        <h5 class="mt-3">File upload forms</h5>
        <div class="row g-2">
        {% for f in a.file_uploads %}
          <div class="col-md-8" data-aos="fade-up">
            <div class="card">
              <div class="card-body">
                <div>Action: {{ f.form.action }} Method: {{ f.form.method }} {% if f.issue %} <span class="badge bg-warning ms-2">{{ f.issue }}</span>{% endif %}</div>
                {% if f.active_test %}
                  <div class="mt-2">Active upload test: {{ f.active_test.status_code if f.active_test.status_code else f.active_test.error }}</div>
                {% endif %}
              </div>
            </div>
          </div>
        {% endfor %}
        </div>
      {% endif %}

      {% if a.auth_active %}
        <h5 class="mt-3">Active login attempts (brute-force)</h5>
        <div class="row g-2">
        {% for fa in a.auth_active %}
          <div class="col-md-8" data-aos="fade-up">
            <div class="card">
              <div class="card-body">
                <div><strong>Form:</strong> {{ fa.form.action }} ({{ fa.form.method }})</div>
                <div class="mt-2">Attempts:</div>
                <ul>
                {% for at in fa.attempts %}
                  <li>{{ at.user }} â€” {% if at.status %}status {{ at.status }}, len={{ at.len }}{% else %}error: {{ at.error }}{% endif %}</li>
                {% endfor %}
                </ul>
              </div>
            </div>
          </div>
        {% endfor %}
        </div>
      {% endif %}


      <h3>Suggestions & Remediation</h3>
      {% if results.suggestions %}
        {% for cat, items in results.suggestions.items() %}
          <h5>{{ cat.upper() }}</h5>
          {% if items %}
            <ul>
            {% for it in items %}
              <li><strong>{{ it.issue }}</strong><br/>{{ it.recommendation }}</li>
            {% endfor %}
            </ul>
          {% else %}
            <p>No suggestions for {{ cat }}.</p>
          {% endif %}
        {% endfor %}
      {% endif %}

      <div class="mt-4 d-flex gap-2">
        <a class="btn btn-primary" href="/download/{{ job.id }}">Download PDF</a>
        <a class="btn btn-outline-secondary" href="/">Back to scans</a>
      </div>
      {% else %}
        <p>No results available yet for this job.</p>
      {% endif %}
    </div>
    <script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>
    <script> AOS.init({ duration:500, once:true }); </script>
  </body>
</html>
